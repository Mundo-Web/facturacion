var _=Object.defineProperty;var J=(c,e,t)=>e in c?_(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var i=(c,e,t)=>(J(c,typeof e!="symbol"?e+"":e,t),t);import{m as s,r as l,R as a}from"./CreateReactScript-BZNFBiYC.js";import{M as x}from"./Table-7H_SmTdZ.js";import{S as B}from"./Adminto-BunV6och.js";import{I}from"./InputFormGroup-BUOjBXeO.js";import{T as j}from"./TextareaFormGroup-Ch_FAxDs.js";import{S as v,a as k}from"./SetSelectValue-TcZeamg_.js";import{D as O}from"./DropdownItem-mg3Fv28F.js";import{D as q}from"./DropdownEnd-BGPgPEIS.js";class d{}i(d,"paginate",async e=>{const{result:t}=await s.Fetch("/api/client-notes/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return t}),i(d,"byClient",async e=>{const{result:t}=await s.Fetch(`/api/client-notes/client/${e}`);return(t==null?void 0:t.data)??[]}),i(d,"save",async e=>{try{const{status:t,result:r}=await s.Fetch("/api/client-notes",{method:"POST",body:JSON.stringify(e)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(d,"status",async({id:e,status:t})=>{try{const{status:r,result:n}=await s.Fetch("/api/client-notes/status",{method:"PATCH",body:JSON.stringify({id:e,status:t})});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(d,"delete",async e=>{try{const{status:t,result:r}=await s.Fetch(`/api/client-notes/${e}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});const X=({can:c,client:e,setClient:t,grid2refresh:r,page:n})=>{const w=l.useRef(),E=l.useRef(),g=l.useRef(),y=l.useRef(),f=l.useRef(),p=l.useRef(),[T,b]=l.useState([]),[C,N]=l.useState(!1);l.useEffect(()=>{e.id&&D(),$(w.current).on("hidden.bs.modal",()=>{t({}),b([]),N(!1),g.current.value=null,v(y.current,null,null),f.current.value=null,p.current.value=null})},[e]);const D=async()=>{const o=await d.byClient(e==null?void 0:e.id);b(o),$(w.current).modal("show")},F=async o=>{o.preventDefault();const u={id:g.current.value||void 0,type_id:y.current.value,client_id:e.id,name:f.current.value,description:p.current.value};await d.save(u)&&($(E.current).modal("hide"),g.current.value=null,v(y.current,null,null),f.current.value=null,p.current.value=null,await S(),$(r.current).dxDataGrid("instance").refresh())},S=async()=>{const o=await d.byClient(e.id);b(o)},P=async o=>{g.current.value=o.id,v(y.current,o.type.id,o.type.name),f.current.value=o.name,p.current.value=o.description,$(E.current).modal("show"),N(!0)},A=async o=>{const{isConfirmed:u}=await B.fire({title:"Estas seguro de eliminar esta nota?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!u||!await d.delete(o)||(await S(),$(r.current).dxDataGrid("instance").refresh())};return a.createElement(a.Fragment,null,a.createElement(x,{modalRef:w,title:`Notas de ${(e==null?void 0:e.tradename)||(e==null?void 0:e.name)||(e==null?void 0:e.contact_name)}`,size:"full-width",isStatic:!0,hideFooter:!0},a.createElement("div",{style:{height:"calc(100vh - 180px)",overflowY:"auto"}},a.createElement("div",{className:"text-center"},a.createElement("button",{className:"btn btn-primary",type:"button",onClick:()=>$(E.current).modal("show")},"Agregar nota")),a.createElement("hr",{className:"my-2"}),a.createElement("div",{className:"d-flex flex-wrap flex-row justify-content-center gap-2"},T.sort((o,u)=>new Date(u.created_at)-new Date(o.created_at)).map((o,u)=>{const h=moment(o.created_at),R=moment().diff(h,"hours")>12?h.format("lll"):h.fromNow();return a.createElement("div",{key:`note-${u}`,className:"card text-white bg-purple mb-0",style:{width:"100%",maxWidth:"300px",height:"max-content"}},a.createElement("div",{className:"card-body p-2"},a.createElement("div",{className:"d-flex align-items-center border-bottom border-white pb-1 mb-1"},a.createElement("div",{className:"avatar-sm me-2 mb-1"},a.createElement("img",{src:`/api/profile/thumbnail/${o.user.relative_id}?v=${new Date(o.user.updated_at).getTime()}`,className:"img-fluid rounded-circle",alt:"user"})),a.createElement("div",{className:"flex-grow-1 overflow-hidden"},a.createElement("h5",{className:"text-white m-0"},o.user.name," ",o.user.lastname),a.createElement("p",{className:"text-white-50 m-0 font-13 text-truncate"},R)),c(n,"root","all","editnotes","deletenotes")&&a.createElement(q,null,c(n,"root","all","editnotes")&&a.createElement(O,{onClick:()=>P(o)},"Editar"),c(n,"root","all","deletenotes")&&a.createElement(O,{onClick:()=>A(o.id)},"Eliminar"))),a.createElement("blockquote",{className:"card-bodyquote mb-0"},o.name&&a.createElement("b",null,o.name),a.createElement("p",{className:"mb-1"},o.description))))})))),a.createElement(x,{modalRef:E,title:C?"Editar nota":"Agregar nota",size:"sm",onSubmit:F},a.createElement("div",{id:"note-crud-container"},a.createElement("input",{ref:g,type:"hidden"}),a.createElement(k,{eRef:y,label:"Tipo de nota",col:"col-12",dropdownParent:"#note-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",filter:["table_id","=",4],required:!0}),a.createElement(I,{eRef:f,label:"Titulo de la nota"}),a.createElement(j,{eRef:p,label:"Descripcion de la nota",required:!0}))))};class m{}i(m,"paginate",async e=>{const{result:t}=await s.Fetch("/api/clients/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return t}),i(m,"save",async e=>{try{const{status:t,result:r}=await s.Fetch("/api/clients",{method:"POST",body:JSON.stringify(e)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(m,"assign",async(e,t)=>{try{const{status:r,result:n}=await s.Fetch("/api/clients/assign",{method:t?"PUT":"DELETE",body:JSON.stringify({id:e})});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(m,"status",async({id:e,status:t})=>{try{const{status:r,result:n}=await s.Fetch("/api/clients/status",{method:"PATCH",body:JSON.stringify({id:e,status:t})});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(m,"clientStatus",async(e,t)=>{try{const{status:r,result:n}=await s.Fetch("/api/clients/client-status",{method:"PATCH",body:JSON.stringify({client:e,status:t})});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(m,"delete",async e=>{try{const{status:t,result:r}=await s.Fetch(`/api/clients/${e}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return s.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});export{m as C,X as a};
