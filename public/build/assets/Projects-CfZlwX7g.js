import{C as Y,c as B,R as t,r as s,m as G}from"./CreateReactScript-BZNFBiYC.js";import{A as I,S as q}from"./Adminto-BunV6och.js";import{a as L,A as U,P as V}from"./AssignUsersModal-CDJo443f.js";import{P as D,A as O,N as z,D as H}from"./Assigneds-BC0ctRgZ.js";import{T as J,R as w,M as K}from"./Table-7H_SmTdZ.js";import{a as _,S}from"./SetSelectValue-TcZeamg_.js";import{D as m}from"./DxButton-CsjWvhyj.js";import{I as l}from"./InputFormGroup-BUOjBXeO.js";import{T as Q}from"./TextareaFormGroup-Ch_FAxDs.js";import{D as u}from"./DxBox-DBPbzk8d.js";import"./TippyButton-cxVS3TbP.js";import"./Dropdown-Ded-Oq3P.js";import"./DropdownItem-mg3Fv28F.js";import"./server.browser-B4QJrVD-.js";const W=({statuses:p,can:n})=>{const a=s.useRef(),d=s.useRef(),f=s.useRef(),g=s.useRef(),b=s.useRef(),y=s.useRef(),E=s.useRef(),v=s.useRef(),h=s.useRef(),R=s.useRef(),x=s.useRef(),[C,F]=s.useState(!1),[P,N]=s.useState({}),[j,T]=s.useState({}),A=e=>{var r,o,i,c;e!=null&&e.id?F(!0):F(!1),f.current.value=(e==null?void 0:e.id)||null,S(g.current,(r=e==null?void 0:e.client)==null?void 0:r.id,(o=e==null?void 0:e.client)==null?void 0:o.name),S(b.current,(i=e==null?void 0:e.type)==null?void 0:i.id,(c=e==null?void 0:e.type)==null?void 0:c.name),y.current.value=(e==null?void 0:e.name)||null,E.current.value=(e==null?void 0:e.description)||null,v.current.value=e==null?void 0:e.cost,h.current.value=e!=null&&e.sign_at?moment(e.sign_at).format("YYYY-MM-DD"):null,R.current.value=e!=null&&e.starts_at?moment(e.starts_at).format("YYYY-MM-DD"):null,x.current.value=e!=null&&e.ends_at?moment(e.ends_at).format("YYYY-MM-DD"):null,$(d.current).modal("show")},k=async e=>{e.preventDefault();const r={id:f.current.value||void 0,client_id:g.current.value,type_id:b.current.value,name:y.current.value,description:E.current.value,cost:v.current.value??void 0,sign_at:h.current.value??void 0,starts_at:R.current.value,ends_at:x.current.value};await D.save(r)&&($(a.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"))},M=async e=>{const{isConfirmed:r}=await q.fire({title:"Estas seguro?",text:"Esta acciÃ³n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!r||!await D.delete(e)||$(a.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(J,{gridRef:a,title:"Proyectos",rest:D,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),n("projects","root","all","create")&&e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>A()}})},filterValue:void 0,columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc",visible:!1},{dataField:"client.tradename",caption:"Nombre comercial",filterValue:G.GET.client||void 0,fixed:!0,fixedPosition:"left"},{dataField:"type.name",caption:"Tipo"},{dataField:"name",caption:"Proyecto",visible:!1},{dataField:"users",caption:"Asignados",dataType:"string",cellTemplate:(e,{data:r})=>{const o=(r.users||"").split("|").filter(Boolean);e.append(u([O(o)]))}},{dataField:"cost",caption:"Costo",dataType:"number",cellTemplate:(e,{data:r})=>{e.text(`S/. ${z(r.cost)}`)}},{dataField:"remaining_amount",caption:"Pagos",dataType:"number",cellTemplate:(e,{data:r})=>{const o=(r.total_payments/r.cost*100).toFixed(2),i=Number(r.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),c=Number(r.cost-r.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2});e.append(u([t.createElement(t.Fragment,null,t.createElement("p",{className:"mb-0 d-flex justify-content-between"},t.createElement("b",{className:"text-success"},t.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",i),t.createElement("b",{className:"float-end text-danger"},t.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",c)),t.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},t.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated animated",role:"progressbar","aria-valuenow":r.total_payments,"aria-valuemin":"0","aria-valuemax":r.cost,style:{width:`${o}%`,visibility:"visible",animationName:"animationProgress"}})))],!1))}},{dataField:"starts_at",caption:"Fecha de desarrollo",dataType:"date",cellTemplate:(e,{data:r})=>{e.append(u([{width:"200px",height:"30px",children:H(r.starts_at,r.ends_at)}]))}},n("projects","root","all","changestatus")?{dataField:"project_status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(e,{data:r})=>{e.attr("style","overflow: visible"),e.append(u([{height:"28px",children:t.createElement(V,{can:n,statuses:p,data:r,onChange:()=>{$(a.current).dxDataGrid("instance").refresh()}})}]))}}:null,{dataField:"status",caption:"Estado",dataType:"boolean",visible:!1,cellTemplate:(e,{data:r})=>{switch(r.status){case 1:w(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:w(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:w(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{n("projects","root","all","update")&&e.append(m({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>A(r)})),n("projects","root","all","assignUsers")&&e.append(m({className:"btn btn-xs btn-soft-info",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>T(r)})),n("projects","root","all","addpayment")&&e.append(m({className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>N(r)})),n("projects","root","all","delete")&&e.append(m({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>M(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(K,{modalRef:d,title:C?"Editar proyecto":"Agregar proyecto",onSubmit:k},t.createElement("div",{className:"row",id:"project-crud-container"},t.createElement("input",{ref:f,type:"hidden"}),t.createElement(_,{eRef:g,label:"Cliente",col:"col-12",dropdownParent:"#project-crud-container",searchAPI:"/api/clients/paginate",searchBy:"name",required:!0}),t.createElement(_,{eRef:b,label:"Tipo del proyecto",col:"col-md-4",dropdownParent:"#project-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",filter:["table_id","=",1],required:!0}),t.createElement(l,{eRef:y,label:"Nombre del proyecto",col:"col-md-8",required:!0}),t.createElement(Q,{eRef:E,label:"Descripcion del proyecto",col:"col-12"}),t.createElement(l,{eRef:v,label:"Costo",col:"col-md-6",type:"number",step:.01,required:!0}),t.createElement(l,{eRef:h,label:"Fecha firma",col:"col-md-6",type:"date"}),t.createElement(l,{eRef:R,label:"Fecha inicio",col:"col-md-6",type:"date",required:!0}),t.createElement(l,{eRef:x,label:"Fecha fin",col:"col-md-6",type:"date",required:!0}))),t.createElement(L,{can:n,dataLoaded:P,setDataLoaded:N,grid2refresh:$(a.current).dxDataGrid("instance")}),t.createElement(U,{dataLoaded:j,setDataLoaded:T,grid2refresh:$(a.current).dxDataGrid("instance")}))};Y((p,n)=>{if(!n.can("projects","root","all","list"))return location.href="/";B(p).render(t.createElement(I,{...n,title:"Proyectos"},t.createElement(W,{...n})))});
