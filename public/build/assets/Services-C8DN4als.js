var z=Object.defineProperty;var H=(o,i,r)=>i in o?z(o,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[i]=r;var y=(o,i,r)=>(H(o,typeof i!="symbol"?i+"":i,r),r);import{m as p,C as M,c as k,R as e,r as u}from"./CreateReactScript-fryF6WsV.js";import{A as W,i as f}from"./Adminto-CmE1rFjT.js";import{S as P}from"./SelectFormGroup-DgCpZP3V.js";import{B as C}from"./BasicRest-D0snMZXE.js";import{S as q}from"./sweetalert2.all-uggxmCrK.js";import{M as D}from"./Modal-BlYbLNMj.js";import{U as I}from"./UsersRest-CFiqBTqi.js";class K extends C{constructor(){super(...arguments);y(this,"path","services-by-business");y(this,"byBusiness",async r=>{try{const{status:m,result:c}=await p.Fetch(`/api/${this.path}/${r}`);if(!m)throw new Error((c==null?void 0:c.message)||"Ocurrio un error al cargar los servicios vinculados a esta empresa");return c.data}catch(m){return console.error(m),null}});y(this,"enableService",async(r,m)=>{try{const{status:c,result:d}=await p.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify({business:r,service:m})});if(!c)throw new Error((d==null?void 0:d.message)||"Ocurrio un error al habilitar el servicio");return p.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:d.message,type:"success"}),!0}catch(c){return p.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:c.message,type:"danger"}),!1}})}}const Q=(o=[],i)=>{const r=[];return o.forEach((m,c)=>{c==0?r.push(m):r.push(i,m)}),r};class V extends C{constructor(){super(...arguments);y(this,"path","users-by-services-by-business");y(this,"inviteUser",async(r,m)=>{try{const{status:c,result:d}=await p.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify({email:r,match:m})});if(!c)throw new Error((d==null?void 0:d.message)||"Ocurrio un error al agregar el usuario");return p.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:d.message,type:"success"}),!0}catch(c){return p.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:c.message,type:"danger"}),!1}})}}const X=new I,R=new K,Y=new V,Z=({businesses:o=[],services:i=[]})=>{var N,w,x;const r=u.useRef(),m=u.useRef(),c=u.useRef(),[d,O]=u.useState(p.GET.business),[E,F]=u.useState({}),[l,v]=u.useState(null),[U,G]=u.useState([]);u.useEffect(()=>{g()},[d]);const g=async()=>{const t=await R.byBusiness(d),s={};for(const n of t)s[n.service.correlative]=n;return F(s),s},h=({id:t,text:s,element:n})=>{if(!t)return;const a=JSON.parse($(n).attr("data")),b=document.createElement("div");return b.style.display="block",k(b).render(e.createElement(e.Fragment,null,e.createElement("div",{className:"relative d-flex align-items-center py-2"},e.createElement("div",{className:"flex-grow-1 overflow-hidden"},e.createElement("h5",{className:"mt-0 mb-1 text-truncate"},e.createElement("i",{className:"fa fa-building me-1"}),s),e.createElement("p",{className:"d-block text-gray mb-0 font-13 text-truncate"},a.owner.name," ",a.owner.lastname))))),b},T=t=>{const s=$(r.current).find("option:selected"),a=JSON.parse(s.attr("data")).person.document_number;history.pushState(null,null,`/services?business=${a}`),O(a)},J=async(t,s)=>{const{isConfirmed:n}=await q.fire({title:"¿Estás seguro?",text:"Habilitar el servicio puede aumentar los costos.",icon:"info",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!n)return;t.target.disabled=!0;const a=await R.enableService(d,s);t.target.disabled=!1,a&&g()},A=async t=>{v(t),$(c.current).modal("show")},_=async()=>{var n,a;const t=[["email","contains",m.current.value]];(n=l==null?void 0:l.users)!=null&&n.length&&t.push("and",["!",Q((a=l==null?void 0:l.users)==null?void 0:a.map(({email:b})=>["email","=",b]),"or")]);const s=await X.paginate({filter:t});console.log(s),G((s==null?void 0:s.data)??[])},j=async t=>{const s=l.id;if(!await Y.inviteUser(t,s))return;console.log("Marca 1:",E,l);const a=await g();v(a[l.service.correlative])};return e.createElement(e.Fragment,null,e.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"}},e.createElement("div",null,e.createElement("div",{className:"mx-auto",style:{width:"240px"}},e.createElement(P,{eRef:r,templateResult:h,templateSelection:h,onChange:T},o.map((t,s)=>e.createElement("option",{key:`business-${s}`,value:t.id,data:JSON.stringify(t),selected:p.GET.business==t.person.document_number},t.name)))),e.createElement("hr",{className:"mx-auto",style:{width:"180px"}}),e.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-3"},i.map((t,s)=>{const n=E[t.correlative];return e.createElement("div",{key:`service-${s}`,className:"card mb-0",style:{width:"100%",maxWidth:"360px"}},e.createElement("div",{className:"card-body project-box"},e.createElement("div",{className:"badge bg-primary float-end"},"Gratis"),e.createElement("h4",{className:"mt-0"},e.createElement("a",{href:"",className:"text-dark"},t.name," ",e.createElement("i",{className:"mdi mdi-arrow-top-right"}))),e.createElement("p",{className:"text-success text-uppercase font-13"},t.correlative),e.createElement("p",{className:"text-muted font-13",style:{display:"-webkit-box",WebkitLineClamp:2,textOverflow:"ellipsis",WebkitBoxOrient:"vertical",overflow:"hidden",height:"38px"}},t.description),e.createElement("div",{className:"project-members mb-0"},n?e.createElement(e.Fragment,null,e.createElement("h5",{className:"float-start me-3"},"Equipo :"),e.createElement("div",{className:"avatar-group"},n.users.map((a,b)=>{var S,B;return e.createElement("div",{key:`user-${b}`,className:"avatar-group-item mb-0"},e.createElement(f,{content:`${((S=a==null?void 0:a.person)==null?void 0:S.name)||(a==null?void 0:a.name)} ${((B=a==null?void 0:a.person)==null?void 0:B.lastname)||(a==null?void 0:a.lastname)}`},e.createElement("img",{src:`/api/profile/thumbnail/${a.relative_id}`,className:"rounded-circle avatar-sm",alt:`${a.name} ${a.lastname}`})))}),e.createElement("div",{className:"avatar-group-item mb-0",style:{cursor:"pointer"},onClick:()=>A(n)},e.createElement(f,{content:"Gestionar usuarios"},e.createElement("img",{src:"/assets/img/plus.svg",className:"rounded-circle avatar-sm",alt:"Gestionar usuarios",style:{backgroundColor:"rgba(255, 255, 255, .5)",border:"1px solid transparent"}}))))):e.createElement(f,{content:"Habilitar servicio"},e.createElement("button",{type:"button",className:"btn btn-sm btn-soft-primary rounded-pill waves-effect waves-light",onClick:a=>J(a,t.correlative)},e.createElement("i",{className:"mdi mdi-plus"})," Habilitar")))))})))),e.createElement(D,{modalRef:c,onSubmit:t=>t.preventDefault(),title:`Gestionar acceso a ${(N=l==null?void 0:l.service)==null?void 0:N.name}`,size:"md",isStatic:!0,hideFooter:!0},e.createElement("div",{className:"d-block btn-group mx-auto",style:{width:"max-content"}},e.createElement("button",{type:"button",className:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"},e.createElement("i",{className:"fa fa-user-plus"})," Agregar usuarios a este servicio"),e.createElement("div",{className:"dropdown-menu dropdown-menu-center p-2",style:{width:"100%"}},e.createElement("input",{ref:m,className:"form-control mb-2",type:"text",onChange:_}),U.map((t,s)=>{var n,a;return e.createElement(e.Fragment,null,e.createElement("a",{key:`user-${s}`,className:"dropdown-item py-1 px-2 border-t",href:"#",onClick:()=>j(t.email)},e.createElement("p",{className:"mb-0 text-bold text-truncate"},((n=t==null?void 0:t.person)==null?void 0:n.name)||(t==null?void 0:t.name)," ",((a=t==null?void 0:t.person)==null?void 0:a.lastname)||(t==null?void 0:t.lastname)),e.createElement("p",{className:"mb-0 text-muted text-truncate",style:{fontSize:"small"}},t.email)))}))),e.createElement("hr",{className:"mx-auto",style:{maxWidth:"240px",width:"100%"}}),e.createElement("div",null,((w=l==null?void 0:l.users)==null?void 0:w.length)>0?e.createElement("table",{style:{width:"100%"}},e.createElement("tbody",null,(x=l==null?void 0:l.users)==null?void 0:x.map((t,s)=>{var n,a;return e.createElement("tr",{key:`user-${s}`},e.createElement("td",null,e.createElement("img",{src:`/api/profile/thumbnail/${t.relative_id}`,className:"rounded-circle avatar-sm me-1",alt:`${t.name} ${t.lastname}`})),e.createElement("td",null,e.createElement("div",null,e.createElement("h5",{className:"mt-1 mb-1 text-truncate"},((n=t==null?void 0:t.person)==null?void 0:n.name)||(t==null?void 0:t.name)," ",((a=t==null?void 0:t.person)==null?void 0:a.lastname)||(t==null?void 0:t.lastname)),e.createElement("p",{className:"mb-1 text-truncate",style:{fontSize:"small"}},t==null?void 0:t.email))),e.createElement("td",{align:"center"},t.pivot.invitation_accepted==!1&&e.createElement(f,{content:"El usuario no ha aceptado la invitacion"},e.createElement("p",{className:"mb-0 text-danger",style:{fontSize:"small"}},"Pendiente")),e.createElement("button",{className:"btn btn-xs btn-white rounded-pill"},e.createElement("i",{className:"fa fa-trash"}))))}))):e.createElement("i",{className:"d-block text-center text-muted"},"- No hay usuarios vinculados -"))))};M((o,i)=>{k(o).render(e.createElement(W,{...i,title:"Servicios"},e.createElement(Z,{...i})))});
