var k=Object.defineProperty;var O=(n,r,t)=>r in n?k(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var m=(n,r,t)=>(O(n,typeof r!="symbol"?r+"":r,t),t);import{J as P}from"./JSEncrypt-D3I3x59l.js";import{m as l,C as q,c as G,R as a,r as i}from"./CreateReactScript-BZNFBiYC.js";import{T as I,R as w,M as B}from"./Table-7H_SmTdZ.js";import{a as j,S as J}from"./SetSelectValue-TcZeamg_.js";import{R as M}from"./RolesRest-BIP0dnCB.js";import{A as U}from"./Adminto-BunV6och.js";import{I as N}from"./InputFormGroup-BUOjBXeO.js";import{P as S}from"./PasswordFormGroup-zFVO4Fqi.js";import{D as z}from"./DxBox-DBPbzk8d.js";import{D as d}from"./DxButton-CsjWvhyj.js";import"./server.browser-B4QJrVD-.js";class u{}m(u,"paginate",async r=>{const{result:t}=await l.Fetch("/api/users/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)});return t}),m(u,"save",async r=>{try{const{status:t,result:o}=await l.Fetch("/api/users",{method:"POST",body:JSON.stringify(r)});if(!t)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(t){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),m(u,"status",async({id:r,status:t})=>{try{const{status:o,result:c}=await l.Fetch("/api/users/status",{method:"PATCH",body:JSON.stringify({id:r,status:t})});if(!o)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(o){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:o.message,type:"danger"}),!1}}),m(u,"delete",async r=>{try{const{status:t,result:o}=await l.Fetch(`/api/users/${r}`,{method:"DELETE"});if(!t)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(t){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});const H=({can:n,PUBLIC_RSA_KEY:r})=>{const t=i.useRef(),o=i.useRef(),c=i.useRef(),p=i.useRef(),f=i.useRef(),g=i.useRef(),y=i.useRef(),b=i.useRef(),E=i.useRef(),h=new P;h.setPublicKey(r);const[R,x]=i.useState(!1),C=async e=>{e!=null&&e.id?x(!0):x(!1);const s=await M.byUser(e==null?void 0:e.id);c.current.value=(e==null?void 0:e.id)||null,p.current.value=(e==null?void 0:e.name)||null,f.current.value=(e==null?void 0:e.lastname)||null,g.current.value=(e==null?void 0:e.email)||null,J(y.current,s,"id","name"),b.current.value=null,E.current.value=null,$(o.current).modal("show")},A=async e=>{e.preventDefault();const s=b.current.value,v=E.current.value,D={id:c.current.value||void 0,name:p.current.value,lastname:f.current.value,email:g.current.value,roles:$(y.current).val(),password:s?h.encrypt(s):void 0,confirm:v?h.encrypt(v):void 0};await u.save(D)&&($(t.current).dxDataGrid("instance").refresh(),$(o.current).modal("hide"))},F=async({id:e,status:s})=>{await u.status({id:e,status:s})&&$(t.current).dxDataGrid("instance").refresh()},T=async e=>{await u.delete(e)&&$(t.current).dxDataGrid("instance").refresh()};return a.createElement(a.Fragment,null,a.createElement(I,{gridRef:t,title:"Usuarios",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo",dataType:"email",cellTemplate:(e,{data:s})=>{e.append(z([a.createElement("img",{className:"avatar-xs rounded-circle",src:`/api/profile/thumbnail/${s.relative_id}`,alt:s.name}),a.createElement("p",{className:"mb-0",style:{fontSize:"14px"}},s.email)],!1))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:s})=>{switch(s.status){case 1:w(e,a.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:w(e,a.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:w(e,a.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{n("users","root","all","update")&&e.append(d({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>C(s)})),n("projects","root","all","assignUsers")&&e.append(d({className:"btn btn-xs btn-soft-info",title:"Asignar proyectos",icon:"fas fa-folder-plus",onClick:()=>onAssignProjects()})),n("users","root","all","update")&&e.append(d({className:"btn btn-xs btn-light",title:s.status===null?"Restaurar":"Cambiar estado",icon:s.status===1?"fa fa-toggle-on text-success":s.status===0?"fa fa-toggle-off text-danger":"fas fa-trash-restore",onClick:()=>F(s)})),n("users","root","all","delete")&&e.append(d({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>T(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),a.createElement(B,{modalRef:o,title:R?"Editar usuario":"Agregar usuario",onSubmit:A},a.createElement("div",{className:"row",id:"users-crud-container"},a.createElement("input",{ref:c,type:"hidden"}),a.createElement(N,{eRef:p,label:"Nombres",col:"col-md-6",required:!0}),a.createElement(N,{eRef:f,label:"Apellidos",col:"col-md-6",required:!0}),a.createElement(N,{eRef:g,label:"Correo",col:"col-12",type:"email",required:!0}),a.createElement(j,{eRef:y,label:"Asignar roles",col:"col-12",dropdownParent:"#users-crud-container",searchAPI:"/api/roles/paginate",searchBy:"name",required:!0,multiple:!0}),a.createElement(S,{eRef:b,label:"Contraseña",col:"col-md-6",required:!R}),a.createElement(S,{eRef:E,label:"Repetir contraseña",col:"col-md-6",required:!R}))))};q((n,r)=>{G(n).render(a.createElement(U,{...r,title:"Usuarios"},a.createElement(H,{...r})))});
